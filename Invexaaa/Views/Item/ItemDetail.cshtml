@model Invexaaa.Models.ViewModels.ItemDetailViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    ViewData["Title"] = "Item Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";
    bool isInactive = Model.Status == "Inactive";
}

<div class="detailPage">
    <div class="detailGrid">

        <!-- LEFT -->
        <div class="panel">
            <div class="panel__header">
                <div class="sectionTitle">Item Image</div>
            </div>

            <div class="panel__body">

                <div class="image-square">
                    @if (!string.IsNullOrWhiteSpace(Model.ImageUrl))
                    {
                        <img class="main-image"
                             src="@Model.ImageUrl"
                             alt="@Model.ItemName"
                             onerror="this.onerror=null;this.src='/images/no-image.png';" />
                    }
                    else
                    {
                        <div class="img-empty">
                            <i class="bi bi-image"></i>
                            <div class="t">No image</div>
                            <a href="/Item/EditItem/@Model.ItemID" class="img-edit-link">
                                Upload in Edit
                            </a>
                        </div>
                    }
                </div>

                <div class="barcode-box">
                    @if (!string.IsNullOrWhiteSpace(Model.ItemBarcode))
                    {
                        <img src="@Url.Action("Generate", "Barcode", new { code = Model.ItemBarcode })" alt="Barcode" />
                        <div class="barcode-text">@Model.ItemBarcode</div>
                    }
                    else
                    {
                        <div class="barcode-text">No barcode available</div>
                    }
                </div>

            </div>
        </div>


        <!-- RIGHT -->
        <div class="panel">
            <div class="panel__header">
                <div>
                    <div class="pageTitle">@Model.ItemName</div>
                    <div class="subText">@Model.CategoryName • @Model.SupplierName</div>
                </div>

                <span class="pill @(isInactive ? "pill--inactive" : "pill--active")">
                    @(isInactive ? "INACTIVE · LOCKED" : "ACTIVE")
                </span>
            </div>

            <div class="panel__body">

                <div class="kv">
                    <div class="box">
                        <div class="k">Balance</div>
                        <div class="v">@Model.CurrentBalance</div>
                    </div>
                    <div class="box">
                        <div class="k">Reorder Level</div>
                        <div class="v">@Model.ReorderLevel</div>
                    </div>
                </div>

                <div class="hr"></div>

                <div class="infoGrid">
                    <div class="infoRow">
                        <div class="infoLabel">Unit</div>
                        <div class="infoValue">@Model.UnitOfMeasure</div>
                    </div>

                    <div class="infoRow">
                        <div class="infoLabel">Buy Price</div>
                        <div class="infoValue money">RM @Model.BuyPrice.ToString("0.00")</div>
                    </div>

                    <div class="infoRow">
                        <div class="infoLabel">Sell Price</div>
                        <div class="infoValue money">RM @Model.SellPrice.ToString("0.00")</div>
                    </div>
                </div>

                @if (isInactive)
                {
                    <div class="sys-alert">
                        This item is inactive. Stock adjustment, restocking, and expiry edits are disabled.
                    </div>
                }

                <div class="hr"></div>

                <div class="sectionHead">
                    <div class="sectionTitle">Batch Information</div>
                    <div class="subText">@(Model.Batches?.Count ?? 0) batch(es)</div>
                </div>

                <div class="@(isInactive ? "locked" : "")" style="margin-top:10px;">
                    <table class="sys-table">
                        <thead>
                            <tr>
                                <th>Batch No</th>
                                <th>Expiry Date</th>
                                <th>Quantity</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var b in Model.Batches)
                            {
                                <tr>
                                    <td>@b.BatchNo</td>
                                    <td>@b.ExpiryDate.ToString("dd/MM/yyyy")</td>
                                    <td>@b.Quantity</td>
                                    <td>
                                        @if (b.ExpiryStatus == "Near Expiry")
                                        {
                                            <span class="chip chip--warn">Near Expiry</span>
                                        }
                                        else if (b.ExpiryStatus == "Expired")
                                        {
                                            <span class="chip chip--danger">Expired</span>
                                        }
                                        else
                                        {
                                            <span class="chip chip--ok">Safe</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

    </div>


    <style>
        :root {
            --border: #e6e6e6;
            --muted: #7a7a7a;
            --text: #111;
            --bg: #fff;
            --soft: #fafafa;
            --radius: 16px;
        }

        /* ✅ Force WHITE page everywhere */
        html, body, main, .container, .container-fluid {
            background: #fff !important;
        }

        .detailPage {
            padding: 24px 18px;
            background: #fff;
        }

        .detailGrid {
            max-width: 1200px;
            margin: 0 auto; /* ✅ centers BOTH panels together */
            display: grid;
            grid-template-columns: 360px minmax(0, 1fr);
            gap: 22px;
        }


        @@media (max-width:980px) {
            .detailGrid {
                grid-template-columns: 1fr;
            }
        }

        /* panels */
        .panel {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 10px 28px rgba(0,0,0,.06);
            width: 100%; /* 🔒 prevents floating behavior */
        }

        .panel__header {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
        }

        .panel__body {
            padding: 14px 16px 12px;
        }

        /* ===== Typography (ONLY 3 levels) ===== */
        .pageTitle {
            font-size: 1.25rem;
            font-weight: 800;
            line-height: 1.2;
            color: var(--text);
        }

        .sectionTitle {
            font-size: 1rem;
            font-weight: 800;
            color: var(--text);
        }

        .subText {
            margin-top: 4px;
            font-size: .9rem;
            font-weight: 600;
            color: var(--muted);
        }

        /* header pill */
        .pill {
            font-size: .72rem;
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid var(--border);
            letter-spacing: .04em;
            font-weight: 800;
            background: #fff;
            color: var(--text);
            white-space: nowrap;
        }

        .pill--inactive {
            background: #f3f4f6;
            color: #374151;
        }

        .pill--active {
            background: #fff;
            color: #111;
        }

        /* LEFT image */
        .main-image {
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 10px;
            display: block;
        }



        .img-empty {
            width: 100%;
            height: 100%;
            border: 2px dashed var(--border);
            background: var(--soft);
            border-radius: 10px;
            display: grid;
            place-content: center;
            gap: 8px;
            text-align: center;
            color: var(--muted);
            padding: 0; /* ✅ important */
        }


            .img-empty i {
                font-size: 1.4rem;
                color: #9ca3af;
            }

            .img-empty .t {
                font-weight: 800;
                color: #374151;
                font-size: .95rem;
            }

            .img-empty .s {
                font-size: .85rem;
            }

        .barcode-box {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed var(--border);
            text-align: center;
        }

            .barcode-box img {
                max-width: 240px;
                width: 100%;
                height: auto;
            }

        .barcode-text {
            margin-top: 6px;
            font-size: .85rem;
            font-weight: 600;
            color: var(--muted);
        }

        /* KPI */
        .kv {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 12px;
        }

            .kv .box {
                border: 1px solid var(--border);
                border-radius: 12px;
                padding: 10px 12px;
                background: #fff;
            }

            .kv .k {
                font-size: .82rem;
                font-weight: 700;
                color: var(--muted);
            }

            .kv .v {
                margin-top: 3px;
                font-size: 1.05rem;
                font-weight: 900;
                color: var(--text);
            }

        /* divider */
        .hr {
            border-top: 1px solid var(--border);
            margin: 14px 0;
        }

        /* info grid */
        .infoGrid {
            border: 1px solid var(--border);
            border-radius: 14px;
            overflow: hidden;
            background: #fff;
        }

        .infoRow {
            display: grid;
            grid-template-columns: 140px 1fr;
            gap: 12px;
            padding: 12px 14px;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
        }

            .infoRow:last-child {
                border-bottom: none;
            }

        .infoLabel {
            font-size: .85rem;
            font-weight: 700;
            color: var(--muted);
        }

        .infoValue {
            font-size: .95rem;
            font-weight: 900;
            color: var(--text);
            text-align: right;
        }

        .money {
            font-variant-numeric: tabular-nums;
        }

        /* inactive alert */
        .sys-alert {
            border: 1px dashed var(--border);
            background: var(--soft);
            border-radius: 14px;
            padding: 12px 14px;
            font-size: .9rem;
            font-weight: 600;
            color: #374151;
            margin-top: 12px;
        }

        /* section head */
        .sectionHead {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        /* table */
        .sys-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: .9rem;
            border: 1px solid var(--border);
            border-radius: 14px;
            overflow: hidden;
        }

            .sys-table thead th {
                background: #f7f7f7;
                color: #444;
                font-weight: 800;
                padding: 10px 12px;
                border-bottom: 1px solid var(--border);
                text-align: left;
            }

            .sys-table tbody td {
                padding: 10px 12px;
                border-bottom: 1px solid #f0f0f0;
            }

            .sys-table tbody tr:last-child td {
                border-bottom: none;
            }

        /* chips */
        .chip {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            border-radius: 999px;
            font-size: .75rem;
            font-weight: 900;
            border: 1px solid var(--border);
            background: #fff;
        }

        .chip--ok {
            color: #111;
        }

        .chip--warn {
            color: #9a3412;
            background: #fff7ed;
            border-color: #f59e0b;
        }

        .chip--danger {
            color: #7f1d1d;
            background: #fef2f2;
            border-color: #ef4444;
        }

        /* lock */
        .locked {
            opacity: .65;
            pointer-events: none;
        }

        .img-edit-link {
            font-size: .85rem;
            font-weight: 700;
            color: #4b5563; /* muted but clear */
            text-decoration: none;
            display: inline-block;
        }

            .img-edit-link:hover {
                color: #111;
                text-decoration: underline;
            }

        /* ===== Square Image Container (match Create/Edit) ===== */
        .image-square {
            width: 100%;
            max-width: 320px; /* ✅ cap size like Create/Edit preview */
            margin: 0 auto; /* ✅ center inside panel */
            aspect-ratio: 1 / 1; /* ✅ perfect square */
            background: var(--soft);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

    </style>
