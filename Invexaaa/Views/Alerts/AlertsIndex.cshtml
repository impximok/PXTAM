@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model Invexaaa.Models.ViewModels.AlertsDashboardViewModel

@{
    ViewData["Title"] = "Alerts & Notifications";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 class="page-title">Alerts</h2>

<div class="alerts-grid">

    <!-- ========== EXPIRED ========== -->
    <section class="alerts-column">
        <header class="column-header">
            <span>Expired</span>
            <i class="bi bi-x-circle"></i>
        </header>

        <div class="column-body">
            @if (!Model.ExpiredItems.Any())
            {
                <div class="empty">No expired batches</div>
            }
            else
            {
                @foreach (var item in Model.ExpiredItems)
                {
                    bool isInactive = item.ItemStatus == "Inactive";

                    <div class="card @(isInactive ? "inactive-card" : "")">
                        <div class="card-title">
                            Batch @item.BatchNumber
                        </div>

                        <div class="card-meta">
                            ID @item.BatchID · Qty @item.Quantity
                        </div>

                        <div class="card-meta subtle">
                            Expired @item.ExpiryDate.ToShortDateString()
                        </div>

                        @if (isInactive)
                        {
                            <span class="inactive-badge mt-2">INACTIVE</span>
                        }
                        else
                        {
                            <a asp-controller="Stock"
                               asp-action="StockBatchDetails"
                               asp-route-id="@item.BatchID"
                               class="action">
                                View batch →
                            </a>
                        }
                    </div>
                }
            }
        </div>
    </section>

    <!-- ========== NEAR EXPIRY ========== -->
    <section class="alerts-column">
        <header class="column-header">
            <span>Near Expiry</span>
            <i class="bi bi-hourglass"></i>
        </header>

        <div class="column-body">
            @if (!Model.NearExpiryItems.Any())
            {
                <div class="empty">Nothing expiring soon</div>
            }
            else
            {
                @foreach (var item in Model.NearExpiryItems)
                {
                    bool isInactive = item.ItemStatus == "Inactive";

                    <div class="card @(isInactive ? "inactive-card" : "")">
                        <div class="card-title">
                            Batch @item.BatchNumber
                        </div>

                        <div class="card-meta">
                            ID @item.BatchID · Qty @item.Quantity
                        </div>

                        <div class="card-meta subtle">
                            Expires @item.ExpiryDate.ToShortDateString()
                        </div>

                        @if (isInactive)
                        {
                            <span class="inactive-badge mt-2">INACTIVE</span>
                        }
                        else
                        {
                            <a asp-controller="Stock"
                               asp-action="StockBatchDetails"
                               asp-route-id="@item.BatchID"
                               class="action">
                                Manage →
                            </a>
                        }
                    </div>
                }
            }
        </div>
    </section>

    <!-- ========== LOW STOCK ========== -->
    <section class="alerts-column">
        <header class="column-header">
            <span>Low Stock</span>
            <i class="bi bi-box"></i>
        </header>

        <div class="column-body">
            @if (!Model.LowStockItems.Any())
            {
                <div class="empty">Stock levels healthy</div>
            }
            else
            {
                @foreach (var item in Model.LowStockItems)
                {
                    bool isInactive = item.ItemStatus == "Inactive";

                    <div class="card @(isInactive ? "inactive-card" : "")">
                        <div class="card-title">
                            @item.ItemName
                        </div>

                        <div class="card-meta">
                            Item ID @item.ItemID
                        </div>

                        <div class="card-meta subtle">
                            Stock @item.TotalQuantity · Updated @item.LastUpdated.ToShortDateString()
                        </div>

                        @if (isInactive)
                        {
                            <span class="inactive-badge mt-2">INACTIVE</span>
                        }
                        else
                        {
                            <a asp-controller="Inventory"
                               asp-action="InventoryDetails"
                               asp-route-id="@item.InventoryID"
                               class="action">
                                View inventory →
                            </a>
                        }
                    </div>
                }
            }
        </div>
    </section>

    <!-- ========== REORDER ========== -->
    <section class="alerts-column">
        <header class="column-header">
            <span>Reorder</span>
            <i class="bi bi-arrow-repeat"></i>
        </header>

        <div class="column-body">
            @if (!Model.ReorderItems.Any())
            {
                <div class="empty">No reorder required</div>
            }
            else
            {
                @foreach (var item in Model.ReorderItems)
                {
                    bool isInactive = item.ItemStatus == "Inactive";

                    <div class="card @(isInactive ? "inactive-card" : "")">
                        <div class="card-title">
                            @item.ItemName
                        </div>

                        <div class="card-meta">
                            Balance @item.CurrentBalance · Reorder @item.ReorderLevel
                        </div>

                        <div class="card-meta subtle">
                            Safety stock @item.SafetyStock
                        </div>

                        @if (isInactive)
                        {
                            <span class="inactive-badge mt-2">INACTIVE</span>
                        }
                        else
                        {
                            <a asp-controller="Stock"
                               asp-action="AddStockBatch"
                               asp-route-inventoryIds="@item.InventoryID"
                               class="action">
                                Restock →
                            </a>
                        }
                    </div>
                }
            }
        </div>
    </section>

</div>

<style>
    /* ========= PAGE ========= */

    .page-title {
        font-weight: 600;
        margin-bottom: 24px;
        letter-spacing: -0.3px;
    }

    /* ========= GRID ========= */

    .alerts-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 24px;
    }

    /* ========= COLUMNS ========= */

    .alerts-column {
        border: 1px solid #e5e7eb;
        border-radius: 18px;
        background: #fff;
        height: 72vh;
        display: flex;
        flex-direction: column;
    }

    .column-header {
        padding: 14px 18px;
        font-size: 13px;
        font-weight: 500;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #f1f5f9;
    }

    .column-body {
        padding: 16px;
        overflow-y: auto;
    }

    /* ========= CARDS ========= */

    .card {
        padding: 14px 16px;
        border-radius: 14px;
        background: #fafafa;
        border: 1px solid #ededed;
        margin-bottom: 14px;
    }

    .inactive-card {
        opacity: 0.55;
        filter: grayscale(100%);
    }

    .inactive-badge {
        background: #e5e7eb;
        color: #374151;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 11px;
        font-weight: 600;
        display: inline-block;
        margin-top: 8px;
    }

    /* ========= ACTION ========= */

    .action {
        display: inline-block;
        margin-top: 10px;
        font-size: 12px;
        font-weight: 500;
        color: #000;
        text-decoration: none;
    }

        .action:hover {
            text-decoration: underline;
        }

    .empty {
        font-size: 13px;
        color: #9ca3af;
        text-align: center;
        margin-top: 32px;
    }
</style>
