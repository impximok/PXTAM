@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model List<SnomiAssignmentReal.Models.CustomerOrder>
@{
    ViewData["Title"] = "My CustomerOrders";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@if (TempData["Error"] is string err && !string.IsNullOrWhiteSpace(err))
{
    <div class="alert alert-danger mt-3">@err</div>
}
@if (TempData["Info"] is string info && !string.IsNullOrWhiteSpace(info))
{
    <div class="alert alert-info mt-3">@info</div>
}

<div class="container my-4">
    <h2 class="fw-semibold mb-3">My Orders</h2>

    @if (Model == null || !Model.Any())
    {
        <div class="alert alert-secondary">
            You have not placed any orders yet.
        </div>
    }
    else
    {
        <table class="table table-hover align-middle shadow-sm">
            <thead class="table-dark">
                <tr>
                    <th>Order</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th class="text-end">Total</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var order in Model)
                {
                    var total = order.NetPayableAmount > 0
                    ? order.NetPayableAmount
                    : (order.OrderTotalAmount - order.TotalDiscountAmount);
                    if (total < 0) total = 0;

                    <tr>
                        <td>@order.CustomerOrderId</td>
                        <td>@order.OrderCreatedAt.ToString("yyyy-MM-dd HH:mm")</td>
                        <td>
                            @{
                                var status = order.OrderStatus ?? "Unknown";
                                var badgeClass = status switch
                                {
                                    "Cart" => "bg-secondary",
                                    "AwaitingPayment" => "bg-warning text-dark",
                                    "Ordered" => "bg-info text-dark",
                                    "Preparing" => "bg-primary",
                                    "Ready" => "bg-success",
                                    "Served" => "bg-dark",
                                    "Completed" => "bg-success",
                                    "Cancelled" => "bg-danger",
                                    _ => "bg-light text-dark"
                                };
                            }
                            <span class="badge @badgeClass">@status</span>
                        </td>
                        <td class="text-end">@total.ToString("C")</td>
                        <td class="text-end">
                            <a class="btn btn-sm btn-outline-dark"
                               asp-controller="Order"
                               asp-action="Track"
                               asp-route-id="@order.CustomerOrderId">
                                Track
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>
