@model IEnumerable<Invexaaa.Models.ViewModels.StockViewModel>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    ViewData["Title"] = "Manage Stock";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    /* ===============================
       MANAGE STOCK PAGE
    =============================== */

    .stock-page h3 {
        font-weight: 600;
    }

    #bulkAddBtn {
        width: 42px;
        height: 42px;
        font-size: 20px;
        border-radius: 10px;
    }

    .table th,
    .table td {
        vertical-align: middle;
    }

    .table thead {
        background: #f8f9fa;
    }

    .stock-checkbox {
        width: 18px;
        height: 18px;
    }

    .stock-row:hover {
        background: #fafafa;
    }
</style>

<div class="container-fluid stock-page">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="fw-semibold">Manage Stock</h3>

        <!-- PLUS BUTTON (BULK ADD) -->
        <button id="bulkAddBtn"
                class="btn btn-success"
                disabled
                title="Add stock to selected items">
            ＋
        </button>
    </div>

    <!-- TABLE -->
    <div class="card">
        <div class="table-responsive">
            <table class="table align-middle mb-0" id="stockTable">

                <thead>
                    <tr>
                        <th style="width:40px">
                            <input type="checkbox"
                                   id="selectAll"
                                   class="stock-checkbox" />
                        </th>
                        <th>Item</th>
                        <th>Category</th>
                        <th>Available</th>
                        <th>Status</th>
                        <th>Updated</th>
                        <th style="width:120px">Actions</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var s in Model)
                    {
                        <tr class="stock-row" data-status="@s.StockStatus">

                            <!-- CHECKBOX -->
                            <td>
                                <input type="checkbox"
                                       class="row-check stock-checkbox"
                                       value="@s.InventoryID" />
                            </td>

                            <!-- ITEM -->
                            <td>
                                <strong>@s.ItemName</strong>
                            </td>

                            <!-- CATEGORY -->
                            <td>@s.CategoryName</td>

                            <!-- QUANTITY -->
                            <td>@s.AvailableQuantity</td>

                            <!-- STATUS -->
                            <td>
                                <span class="badge
                                    @(s.StockStatus == "In Stock" ? "bg-success" :
                                                                        s.StockStatus == "Low Stock" ? "bg-warning" :
                                                                        "bg-danger")">
                                @s.StockStatus
                            </span>
                        </td>

                            <!-- UPDATED -->
                            <td>@s.LastUpdated.ToString("dd/MM/yyyy")</td>

                            <!-- ACTION -->
                            <td>
                                <a asp-action="AdjustStockByBatch"
                                   asp-route-inventoryId="@s.InventoryID"
                                   class="btn btn-sm btn-outline-primary">
                                    Adjust
                                </a>
                            </td>

                        </tr>
                                        }
                </tbody>

            </table>
        </div>
    </div>

</div>

@section Scripts {
    <script>
        /* ===============================
           BULK SELECT + ADD LOGIC
        =============================== */

        const selectAll = document.getElementById("selectAll");
        const checks = document.querySelectorAll(".row-check");
        const bulkBtn = document.getElementById("bulkAddBtn");

        function updateBulkButton() {
            bulkBtn.disabled =
                document.querySelectorAll(".row-check:checked").length === 0;
        }

        /* Select all */
        selectAll.addEventListener("change", function () {
            checks.forEach(c => c.checked = this.checked);
            updateBulkButton();
        });

        /* Individual checkbox */
        checks.forEach(c =>
            c.addEventListener("change", updateBulkButton)
        );

        /* Bulk add click */
        bulkBtn.addEventListener("click", function () {
            const ids = Array.from(
                document.querySelectorAll(".row-check:checked")
            ).map(c => c.value).join(",");

            window.location.href =
                `/Stock/AddStockBatch?inventoryIds=${ids}`;
        });
    </script>
}
