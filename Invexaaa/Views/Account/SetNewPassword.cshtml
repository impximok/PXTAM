@*
@model SnomiAssignmentReal.Models.ViewModels.SetNewPasswordVm
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Set New HashedPassword";
    ViewBag.HideHeader = true;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

<div class="page-center">
    <div class="card border-0 shadow-sm rounded-4 p-4 bg-white auth-wrap">
        <div class="text-center mb-4">
            <h2 class="fw-semibold mb-1 text-dark">Set a new password</h2>
            <p class="text-muted small">Choose a strong password to secure your account.</p>
        </div>

        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger text-center">@TempData["Error"]</div>
        }
        @if (TempData["Info"] != null)
        {
            <div class="alert alert-info text-center">@TempData["Info"]</div>
        }

        <form asp-action="SetNewPassword" asp-controller="Account" method="post" novalidate>
            @Html.AntiForgeryToken()

            <div asp-validation-summary="ModelOnly" class="text-danger small mb-2"></div>

            <input type="hidden" asp-for="Email" />
            <input type="hidden" asp-for="Token" />

            <div class="form-floating mb-3 has-toggle">
                <input asp-for="NewPassword" type="password" class="form-control" id="NewPassword"
                       placeholder="New Password" autocomplete="new-password" />
                <label asp-for="NewPassword">New Password</label>
                <i class="bi bi-eye toggle-eye" data-target="NewPassword" aria-label="Show password" role="button"></i>
            </div>
            <span asp-validation-for="NewPassword" class="text-danger small d-block mb-2"></span>

            <div class="form-floating mb-3 has-toggle">
                <input asp-for="ConfirmPassword" type="password" class="form-control" id="ConfirmPassword"
                       placeholder="Confirm Password" autocomplete="new-password" />
                <label asp-for="ConfirmPassword">Confirm Password</label>
                <i class="bi bi-eye toggle-eye" data-target="ConfirmPassword" aria-label="Show password" role="button"></i>
            </div>
            <span asp-validation-for="ConfirmPassword" class="text-danger small d-block mb-2"></span>


            <div class="d-grid">
                <button type="submit" class="btn btn-custom-black w-100">Update Password</button>
            </div>
        </form>

        <div class="text-center mt-3">
            <a asp-action="Login" asp-controller="Account" class="text-muted small">← Back to Login</a>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.querySelectorAll('.toggle-eye').forEach(icon => {
            icon.addEventListener('click', function () {
                const field = document.getElementById(this.dataset.target);
                const show = field.type === 'password';
                field.type = show ? 'text' : 'password';
                this.classList.toggle('bi-eye', !show);
                this.classList.toggle('bi-eye-slash', show);
                this.setAttribute('aria-label', show ? 'Hide password' : 'Show password');
            });
        });
    </script>
    <script>
        // Hook Bootstrap's red border + message placement
        jQuery(function ($) {
          if ($.validator) {
            $.validator.setDefaults({
              highlight: function (el) { $(el).addClass('is-invalid'); },
              unhighlight: function (el) { $(el).removeClass('is-invalid'); },
              errorClass: 'text-danger small',
              errorPlacement: function (error, element) {
                // Prefer the <span asp-validation-for="..."> if present
                var span = element.closest('form').find('[data-valmsg-for="' + element.attr('name') + '"]');
                if (span.length) span.html(error); else error.insertAfter(element);
              }
            });
          }

          // Client-side rule for PasswordComplexityAttribute
          // The attribute wrote data-val-passwordcomplexity + ...-pattern
          $.validator.addMethod('passwordcomplexity', function (value, el, params) {
            if (!value) return true; // [Required] handles empty
            try {
              // Build regex from server pattern (already escaped)
              var re = new RegExp(params.pattern);
              return re.test(value);
            } catch (e) { return false; }
          });

          $.validator.unobtrusive.adapters.add('passwordcomplexity', ['pattern'], function (options) {
            options.rules['passwordcomplexity'] = { pattern: options.params.pattern };
            options.messages['passwordcomplexity'] = options.message;
          });
        });
    </script>


}

<style>
    /* One-tone background across whole page */
    html, body {
        height: 100%;
        margin: 0;
        background: #f5f5f7 !important; /* light grey */
    }

    /* Center the card on the screen even with header/footer present */
    .page-center {
        min-height: 100dvh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem 1rem;
    }

    .auth-wrap {
        width: 100%;
        max-width: 520px;
        border-radius: 20px;
    }

    /* Minimal black button style */
    .btn-custom-black {
        background-color: #000;
        color: #fff;
        border: 2px solid transparent;
        border-radius: 999px;
        transition: all .2s;
        padding: .65rem 1rem;
        font-weight: 600;
    }

        .btn-custom-black:hover {
            background: #fff;
            color: #000;
            border-color: #000;
        }

    .form-control {
        border-radius: 12px;
    }
    /* floating inputs */
    .form-floating > .form-control {
        height: 3.5rem;
        line-height: 1.25;
        padding-top: 1.25rem;
        padding-bottom: .25rem;
        padding-right: 2.75rem; /* room for the eye */
        padding-left: .75rem;
        border-radius: 12px;
    }

    /* eye icon pinned to the input area */
    .has-toggle {
        position: relative;
    }

        .has-toggle .toggle-eye {
            position: absolute;
            right: .75rem;
            top: 50%;
            transform: translateY(-50%);
            width: 1.25rem;
            height: 1.25rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #666;
            z-index: 3;
            line-height: 1;
            font-size: 1.1rem;
        }

    /* keep Bootstrap's invalid icon from colliding with the eye */
    .form-floating > .form-control.is-invalid {
        padding-right: 2.75rem !important;
        background-position: right 2.25rem center;
    }



</style>
*@