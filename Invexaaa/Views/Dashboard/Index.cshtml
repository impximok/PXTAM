@model Invexaaa.Models.ViewModels.DashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

<style>
    /* ==== DASHBOARD (SCOPED, NO CONFLICT) ==== */

    .invexa-dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }

    .invexa-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 30px;
    }

    .invexa-stat-card {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

        .invexa-stat-card p {
            margin: 0;
            color: #6b7280;
            font-size: 14px;
        }

        .invexa-stat-card h3 {
            margin-top: 8px;
            font-size: 26px;
        }

    .invexa-warning {
        color: #f59e0b;
    }

    .invexa-danger {
        color: #ef4444;
    }

    .invexa-ok {
        color: #22c55e;
    }

    .invexa-content-row {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 25px;
    }

    .invexa-panel {
        background: #fff;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .invexa-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

        .invexa-table th,
        .invexa-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }

</style>

<!-- DASHBOARD HEADER -->
<div class="invexa-dashboard-header">
    <h2>Dashboard</h2>
    <span class="text-muted">Authorized User</span>
</div>

<!-- STATS -->
<div class="invexa-stats">
    <div class="invexa-stat-card">
        <p>Total Items</p>
        <h3>@Model.TotalItems</h3>
        <small class="text-muted">
            Active @Model.ActiveItemCount · Inactive @Model.InactiveItemCount
        </small>
    </div>

    <div class="invexa-stat-card">
        <p>Low Stock</p>
        <h3 class="invexa-warning">@Model.LowStockCount</h3>
    </div>

    <div class="invexa-stat-card">
        <p>Out of Stock</p>
        <h3 class="invexa-danger">@Model.OutOfStockCount</h3>
    </div>

    <div class="invexa-stat-card">
        <p>Reorder Alerts</p>
        <h3 class="invexa-danger">@Model.ReorderAlertCount</h3>
    </div>
</div>

<!-- MAIN CONTENT -->
<div class="invexa-content-row">

    <!-- LEFT PANEL -->
    <div class="invexa-panel">
        <h5>Recent Inventory Activity</h5>

        <table class="invexa-table">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Quantity</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.RecentInventories)
                {
                    bool isInactive = item.ItemStatus == "Inactive";

                    <tr class="@(isInactive ? "text-muted" : "")">
                        <td>
                            @item.ItemName
                            @if (isInactive)
                            {
                                <span class="badge bg-secondary ms-2">INACTIVE</span>
                            }
                        </td>
                        <td>@item.Quantity</td>
                        <td class="@(item.Status == "OK"
                                                    ? "invexa-ok"
                                                    : item.Status == "Low"
                                                        ? "invexa-warning"
                                                        : "invexa-danger")">
                        @item.Status
                    </td>
                </tr>
                                }

            </tbody>
        </table>
    </div>

    <!-- RIGHT PANEL -->
    <div class="invexa-panel text-center">
        <h5>Stock Overview</h5>

        <canvas id="stockChart" width="220" height="220"></canvas>

        <div class="mt-3">
            <p class="mb-1">OK: <strong>@Model.OkStockCount</strong></p>
            <p class="mb-1">Low: <strong class="invexa-warning">@Model.LowStockCount</strong></p>
            <p class="mb-1">Reorder: <strong class="invexa-danger">@Model.ReorderAlertCount</strong></p>
            <p class="mb-3">Out: <strong class="invexa-danger">@Model.OutOfStockCount</strong></p>

            <small class="text-muted">
                Active items only · Inactive excluded
            </small>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        const ctx = document.getElementById('stockChart');

        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['OK', 'Low', 'Reorder', 'Out'],
                datasets: [{
                    data: [
                        @Model.OkStockCount,
                        @Model.LowStockCount,
                        @Model.ReorderAlertCount,
                        @Model.OutOfStockCount
                    ],
                    backgroundColor: [
                        '#22c55e', // OK - green
                        '#f59e0b', // Low - amber
                        '#ef4444', // Reorder - red
                        '#7f1d1d'  // Out - dark red
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                cutout: '70%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            boxWidth: 12,
                            padding: 15
                        }
                    }
                }
            }
        });
    </script>
