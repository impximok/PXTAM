@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model IEnumerable<Invexaaa.Models.Invexa.ExpiryTrackingViewModel>

@{
    ViewData["Title"] = "Expiry Tracking";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="fw-semibold">Expiry Tracking</h3>
    </div>

    <!-- FILTERS -->
    <form method="get" class="row g-2 mb-3">

        <div class="col-md-3">
            <input type="text"
                   name="search"
                   class="form-control"
                   placeholder="Search item name..." />
        </div>

        <div class="col-md-2">
            <select name="categoryId" class="form-select">
                <option value="">Category</option>
                @foreach (var c in ViewBag.Categories)
                {
                    <option value="@c.CategoryID">@c.CategoryName</option>
                }
            </select>
        </div>

        <div class="col-md-2">
            <select name="expiryStatus" class="form-select">
                <option value="">Expiry Status</option>
                <option value="Safe">Safe</option>
                <option value="Near Expiry">Near Expiry</option>
                <option value="Expired">Expired</option>
            </select>
        </div>

        <div class="col-md-2">
            <select name="expiryRange" class="form-select">
                <option value="">Expiry Date Range</option>
                <option value="7">Next 7 Days</option>
                <option value="30">Next 30 Days</option>
            </select>
        </div>

        <div class="col-md-2">
            <button type="submit" class="btn btn-outline-secondary w-100">
                Filter
            </button>
        </div>

    </form>

    <!-- TABLE -->
    <div class="card">
        <div class="table-responsive">
            <table class="table align-middle mb-0">
                <thead class="table-secondary small">
                    <tr>
                        <th>ID</th>
                        <th>Item</th>
                        <th>Category</th>
                        <th>Batch No</th>
                        <th>Quantity</th>
                        <th>Expiry Date</th>
                        <th>Status</th>
                    </tr>
                </thead>

                <tbody>
                    @if (Model.Any())
                    {
                        foreach (var item in Model)
                        {
                            <tr>
                                <!-- ID -->
                                <td>@item.BatchID</td>

                                <!-- ITEM -->
                                <td class="fw-semibold">
                                    @item.ItemName
                                </td>

                                <!-- CATEGORY -->
                                <td>@item.CategoryName</td>

                                <!-- BATCH -->
                                <td>@item.BatchNumber</td>

                                <!-- QTY -->
                                <td class="fw-semibold">
                                    @item.Quantity
                                </td>

                                <!-- EXPIRY -->
                                <td>
                                    @item.ExpiryDate.ToString("dd/MM/yyyy")
                                </td>

                                <!-- STATUS -->
                                <td>
                                    @if (item.ExpiryStatus == "Safe")
                                    {
                                        <span class="badge bg-success">Safe</span>
                                    }
                                    else if (item.ExpiryStatus == "Near Expiry")
                                    {
                                        <span class="badge bg-warning text-dark">
                                            Near Expiry
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-danger">Expired</span>
                                    }
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="7" class="text-center text-muted py-4">
                                No expiry records found.
                            </td>
                        </tr>
                    }
                </tbody>

            </table>
        </div>
    </div>

</div>
